!function(){const t=document,e=String,i=Array,s=Map,l=(JSON,Math),n=/\.([\w_-]+)?/gi,o=/\#([\w_-]+)?/i,a=/^\w+(?=[\#\.]*)/i,u="id",h="option",r="volume",m="match",d="trim",p="body",y="test",c="map",P="ceil",b="youtube",v="vimeo",g="audio",V="video",T="replace",f="length",w="temp",k="createElement",x="getElementById",M="createDocumentFragment",R="createTextNode",F="classList",I="dataset",_="add",A="string",E="number",C="floor",Y="isArray",S="object",B="hasOwnProperty",D="value",$="innerText",L="innerHTML",z="textContent",O="contentEditable",j="indexOf",q="appendChild",N="color",Z="backgroundColor",J="width",G="height",H="display",K="float",Q="setAttribute",U="img",W="source",X="head",tt="PDPlayer",et="link",it="script",st="style",lt="preconnect",nt="preload",ot="anonymous",at="stylesheet",ut="rel",ht="href",rt="async",mt="as",dt="src",pt="crossOrigin",yt="onmousemove",ct="onmouseleave",Pt="https://cdn.jsdelivr.net",bt=Pt+"/npm/pdplayerkit@2.2.2/dist/PDPlayerKit.css",vt="https://fonts.googleapis.com",gt=vt+"/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,1,0",Vt="https://www.youtube.com",Tt=Vt+"/iframe_api",ft="https://player.vimeo.com",wt=ft+"/api/player.js",kt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",xt=/iphone|ipad|ipod|android/i[y](navigator.userAgent),Mt=/iphone|ipad|ipod/i[y](navigator.userAgent),Rt={autoplay:0,controls:0,showinfo:0,modestbranding:1,start:0,loop:0,fs:0,[ut]:0,cc_load_policty:1,iv_load_policy:3,autohide:1};let Ft;function It(e="",i,s){const l=((e[m](a)||[])[0]||"")[d](),u=((e[m](o)||[])[1]||"")[d](),h=(n[y](e)?e[m](n):[])[c]((t=>t[T](/^\./,"")));if(l[f]<1)return;let r,p,P,b=!1;e===w?(b=!0,r=t[M]()):r=t[k](l),u[f]&&(r.id=u);for(let t of h)r[F][_](t);if(null==i&&null!=s&&([i,s]=[s,null]),null!=i&&null!=s)[p,P]=[i,s];else if(null==s)typeof i===A||typeof i===E||Array[Y](i)?P=i:p=i;else if(null==i)return r;if(typeof p===S&&null!=p)for(const t in p){if(!p[B](t))continue;const e=p[t];-1!=[D,$,L,z,O][j](t)?r[t]=e:-1!=[N,Z,J,G,H,K][j](t)?r[st][t]=e:null!=e&&r[Q](t,e)}if(null!=P){const e=typeof P===A,i=typeof P===E,s=Array[Y](P);if(e||i){const e=P;l===U||l===W||"audio"===l?r.src=e:b?r[q](t[R](P)):r[L]=e}else if(s)for(let e of P){const i=e instanceof Element;typeof e===A||typeof e===E?b?r[q](t[R](e)):r[L]+=e:i&&r[q](e)}}return r}function _t(t,e){const i=t,s=l[C](i>3599?i/3600:0),n=l[C](i>3599?i%3600/60:i>59?i/60:0),o=i>3599?i%3600%60:i>59?i%60:i;return e>=3600?`${s<10?`0${s}`:s}:${n<10?`0${n}`:n}:${o<10?`0${o}`:o}`:e>=60?`${n<10?`0${n}`:n}:${o<10?`0${o}`:o}`:`0:${o<10?`0${o}`:o}`}t[X][q](It(et,{[ut]:lt,[ht]:Pt,[pt]:""})),t[X][q](It(et,{[ut]:nt,[ht]:bt,[mt]:st,[pt]:ot})),t[X][q](It(et,{[ht]:bt,[ut]:at})),t[X][q](It(et,{[ut]:lt,[ht]:"https://fonts.gstatic.com",[pt]:""})),t[X][q](It(et,{[ut]:lt,[ht]:vt,[pt]:""})),t[X][q](It(et,{[ut]:nt,[ht]:gt,[mt]:st,[pt]:ot})),t[X][q](It(et,{[ht]:gt,[ut]:at})),t[X][q](It(et,{[ut]:lt,[ht]:Vt,[pt]:""})),t[X][q](It(et,{[ut]:nt,[ht]:Tt,[mt]:it,[pt]:ot})),t[X][q](It(it,{[dt]:Tt,[rt]:""})),t[X][q](It(et,{[ut]:lt,[ht]:ft,[pt]:""})),t[X][q](It(et,{[ut]:nt,[ht]:wt,[mt]:it,[pt]:ot})),t[X][q](It(it,{[dt]:wt,[rt]:""}));let At=new s;function Et(t){const e=kt[f];let s="";do{s=i.from({length:t},(t=>kt.charAt(l[C](l.random()*e)))).join("")}while(At.has(s));return At.set(s,1),s}function Ct(...e){const i=It(it,`console.log.apply(void 0, ${JSON.stringify(e)});`);t[p][q](i),i[_remove]()}window.PDPlayer=class{video;audio;youtube;vimeo;when;option={showThumb:!0,panelType:"",panelItem:["play","progress","time","volumeMini","rate","full"],volume:100,mute:!1};stateFull=!1;#t;#e;#i;#s;#l;#n=!1;#o=100;#a=1;#u=!1;#h=!1;#r=!0;#m=!0;#d=0;#p=0;#y;#c;constructor(t={}){if("object"!=typeof t)return void Ct("config: 不存在。");const s=t[h]||{},l=parseInt(s[r]||t[r]),n=Boolean(s.mute||t.mute),o=Boolean(s.showThumb);if(this.option.panelType=e(s.panelType||t.type||this.option.panelType),this.option.panelItem=i.from(s.panelItem||t.panel||this.option.panelItem),null!=s.showThumb&&(this[h].showThumb=o),null==s[r]||null==t[r]||isNaN(l)||(this[h][r]=l),null!=s.mute&&null!=t.mute&&(this.option.mute=n),this.when=t.when||t.event||{},typeof t[u]===A&&document[x](t[u])?(this[p]=document[x](t[u]),this[p][F][_](tt),this[p][I].type=this.option.panelType,this[p][I].thumb=this.option.showThumb?1:0):this[p]=It("div."+tt,{"data-thumb":this.option.showThumb?1:0,"data-type":this.option.panelType}),null==this[p])return void Ct("body: 不存在");this[p][yt]=this[p][ct]=t=>this.#P(1);const a=e(t[V]||"")[d](),m=e(t[b]||"")[d](),y=e(t[v]||"")[d](),c=e(t[g]||"")[d]();a[f]?(this[V]=a,this.#b()):m[f]?(this[b]=m,this.#v()):y[f]?(this[v]=y,this.#g()):c[f]&&(this[g]=c,this.#V())}#T(t){return xt&&t&&null==this[v]?this.#c:this.#y}isPaused(t){const e=this.#T(t);return this.#t||this.#e?e.paused:this.#i?1!==this.ytState:this.#s?this.#r:void 0}play(t){const e=this.#T(t);!t||this.#l||null==this[b]?(this.#t||this.#e?e.play():this.#i?e.playVideo():this.#s&&t?e.requestFullscreen().then((t=>{e.play()})):this.#s&&e.play(),this.panel.setPlayIcon(!1)):alert("not Ready")}pause(t){const e=this.#T(t);this.#t||this.#e?e.pause():this.#i?e.pauseVideo():this.#s&&e.pause(),this.panel.setPlayIcon(!0)}#f(t){const e=this.isPaused(t);e?this.play():this.pause(),this.panel.setPlayIcon(!e)}#w(t,e){const i=this.#T(e);this.#t||this.#e?i.currentTime=t:this.#i?i.seekTo(t):this.#s&&i.setCurrentTime(t),this.pause()}#k(t){const e=this.#T(t);return this.#t||this.#e?100*e[r]:this.#i?e.getVolume():this.#s?100*this.#o:void 0}#x(t,e){const i=this.#T(e);this[h][r]=parseInt(t),this.#t||this.#e?i[r]=t/100:this.#i?i.setVolume(t):this.#s&&(this.#o=t/100,i.setVolume(t/100)),this.panel.setVolume(t),this.#M(0===parseInt(t))}#M(t,e){const i=null==t?this.isMuted():!t,s=this.#T(e);if(i&&0===this[h][r])return this[h][r]=50,this.#x(50),void this.panel.setMuteIcon(!1);this.#t||this.#e?s.muted=!i:this.#i?i?s.unMute():s.mute():this.#s&&(this.#n=!i,s.setMuted(!i).catch((t=>alert(t)))),this.panel.setMuteIcon(!i)}isMuted(t){const e=this.#T(t);return this.#t||this.#e?e.muted:this.#i?e.isMuted():this.#s?this.#n:void 0}#R(t,e){const i=this.#T(e);this.#t||this.#e?i.playbackRate=t:this.#i?i.setPlaybackRate(t):this.#s&&i.setPlaybackRate(t).catch((t=>alert(t)))}#F(t){const e=this.#T(t);return this.#t||this.#e?e.playbackRate:this.#i?e.getPlaybackRate():this.#s?this.#a:void 0}#I(t){const e=this.#T(t);this.#t||this.#e?this.panel.duration(e.duration):this.#i?this.panel.duration(e.getDuration()):this.#s&&this.#y.getDuration().then((t=>{this.#d=t,this.panel.duration(this.#d)}))}#_(t){const e=this.#T(t);return this.#t||this.#e?l[P](e.duration):null!=this[b]?l[P](e.getDuration()):this.#s?l[P](this.#d):void 0}#A(t){const e=this.#T(t);return this.#t||this.#e?l[P](e.currentTime):null!=this[b]?l[P](e.getCurrentTime()):this.#s?l[P](this.#p):void 0}#E(t){const e=this.#_(t);this.videoTimer=setInterval((()=>{if(this.#s)this.#y.getCurrentTime().then((t=>{this.#p=t,this.panel.setCurrent(l[P](t)),l[P](t)<e||clearInterval(this.videoTimer)}));else{const t=this.#A();if(this.panel.setCurrent(t),l[P](t)<e)return;clearInterval(this.videoTimer)}}),100)}#C(){null!=this.when.ready&&this.when.ready(),null!=this[v]&&(this.#u=this.#r=this.#m=!0,this.#h=!1),this.#t=Boolean(this.video&&this.#y),this.#s=Boolean(this[v]&&this.#y),this.#i=Boolean(this[b]&&this.#y),this.#e=Boolean(this[g]&&this.#y),this.#I(),this.panel.setCurrent(0),this.sec=0,null!=this.option.mute?this.#M(this.option.mute):this.#s&&this.#y.getMuted().then((t=>this.#n=t)),null!=this[h][r]?this.#x(this[h][r]):this.#s&&this.#y.getVolume().then((t=>this.#o=100*t))}#Y(){this.#h=!1,this.#r=this.#m=!1,null!=this.when.playing&&this.when.playing(),this.#i&&(this.start&&(this.start=!1),setTimeout((()=>{this.mask.classList[_]("hide")}),500)),this.#E(),this.panel.hide(1)}#S(){this.#r=!0,this.#h=!1,null!=this.when.pause&&this.when.pause(),clearInterval(this.videoTimer),this.#i&&this.mask.classList.remove("hide"),this.panel.show()}#B(){this.#m=this.#r=!0,this.#h=!1,"function"==typeof this.when.end&&this.when.end(),clearInterval(this.videoTimer),this.panel.reset(),this.#t?this.#y.currentTime=0:this.#i?(this.#w(0),setTimeout((()=>{this.start=!0}),50)):this.#s&&this.#w(0)}#D(){this.pause(),this.#w(this.#A(),!0),this.#x(this.#k(),!0),this.#R(this.#F(),!0),this.play(!0)}#$(){const t=this.#A(!0);this.panel.setCurrent(t),this.#w(t),this.#x(this.#k(!0)),this.#R(this.#F(!0))}#L(){if(this.panel=new Yt(this),null!=this.panel.buttonPlay&&(this.panel.buttonPlay.onclick=t=>this.#f()),null!=this.panel.inputProgress){let t,e;this.panel.inputProgress.oninput=i=>{clearTimeout(t),clearTimeout(e),this.pause();const s=i.target.value;this.panel.setCurrent(s),t=setTimeout((t=>{this.#w(s),e=setTimeout((t=>{this.play()}),500)}),500)}}if(null!=this.panel.buttonVolume){let t;this.panel.buttonVolume.onclick=e=>{clearTimeout(t),t=setTimeout((t=>{this.panel.buttonVolume.parentElement.parentElement.open=!1}),1e3)},this.panel.inputVolumeMini.onmouseover=e=>{clearTimeout(t)},this.panel.inputVolumeMini[ct]=e=>{clearTimeout(t),t=setTimeout((t=>{this.panel.buttonVolume.parentElement.parentElement.open=!1}),1e3)},this.panel.inputVolumeMini.oninput=t=>{const e=t.target.value;this.#x(e)}}null!=this.panel.buttonMute&&(this.panel.buttonMute.onclick=t=>this.#M()),null!=this.panel.inputVolume&&(this.panel.inputVolume.oninput=t=>{const e=t.target.value;this.#x(e)}),null!=this.panel.buttonRate&&(this.panel.buttonRate.onclick=t=>{const e=t.target;"1x_mobiledata"===e.innerText?(e.innerText="speed_1_25",this.#R(1.25)):"speed_1_25"===e.innerText?(e.innerText="speed_1_5x",this.#R(1.5)):"speed_1_5x"===e.innerText?(e.innerText="speed_2x",this.#R(2)):"speed_2x"===e.innerText?(e.innerText="speed_0_5x",this.#R(.5)):(e.innerText="1x_mobiledata",this.#R(1))})}#P(t){null!=this.panel&&(this.panel.show(),null!=t&&this.panel.hide(t))}#V(){null!=this[g]&&(this.#y=It("audio",{preload:"auto",controls:""},[It("source",{src:this[g]})]),this.#L(),this[p][q](this.#y),this[p][q](this.panel[p]),this.#y.onloadedmetadata=()=>this.#C(),this.#y.onplaying=()=>this.#Y(),this.#y.onpause=()=>this.#S(),this.#y.onended=()=>this.#B())}#b(){null!=this[V]&&(this.#y=It("video",{preload:"auto",playsinline:""},[It("source",this[V])]),xt||(this.#y.onclick=t=>this.#f()),this[p][q](this.#y),this.#L(),this[p][q](this.panel[p]),this.#y.onloadedmetadata=t=>this.#C(),this.#y.onplaying=t=>this.#Y(),this.#y.onpause=t=>this.#S(),this.#y.onended=t=>this.#B(),xt&&(this.#c=It("video.PDFullPlayer",{preload:"metadata",playsinline:null},[It("source",this[V])]),this.#c.onplaying=t=>this.#D(),this.#c.onpause=t=>this.#$(),this.#c.onended=t=>this.#B(),Mt?this.#c.addEventListener("webkitpresentationmodechanged",(t=>{this.stateFull="fullscreen"===this.#c.webkitPresentationMode})):this.#c.addEventListener("fullscreenchange",(t=>{this.stateFull=document.fullscreenElement===this.#c})),this[p][q](this.#c)))}#v(){if(null==this[b])return;const t=Et(24),e=Et(24);this.start=!0;const i=It("div#"+t),s=It("div[_body]",[i]);xt||(s.onclick=t=>this.#f()),this[p][q](s),this.mask=It("div.mask",{sec:this.live?"live":0}),xt||(this.mask.onclick=t=>this.#f()),this[p][q](this.mask),this.#L(),this[p][q](this.panel[p]),Ft=async()=>{if(await this.#z(),this.#y=new YT.Player(t,{videoId:this[b],width:"100%",height:"100%",playerVars:{...Rt,playsinline:1},events:{onReady:t=>this.#C(),onStateChange:t=>{this.ytState=t.data,0===t.data?this.#B():1===t.data?this.#Y():2===t.data&&this.#S()}}}),!xt)return;const i=It("div#"+e+".PDFullPlayer");this[p][q](i),this.#c=new YT.Player(e,{videoId:this[b],width:"100%",height:"100%",playerVars:{...Rt,playsinline:0},events:{onReady:t=>{console.log("is Ready"),this.#l=!0},onStateChange:t=>{0===t.data?this.#B():2===t.data?this.#$():3===t.data&&this.#D()}}})},Ft()}#g(){if(null==this[v])return;const t=It("iframe",{src:ft+"/video/"+this[v]+"?background=1&loop=0&autoplay=0&controls=0",frameborder:"0",allowfullscreen:"",allow:"autoplay;"}),e=It("div[_body]",[t]);xt||(e.onclick=t=>this.#f()),this[p][q](e),this.mask=It("div.mask.hide"),xt||(this.mask.onclick=t=>this.#f()),this[p][q](this.mask),this.#L(),this[p][q](this.panel[p]),this.#y=new Vimeo.Player(t),this.#y.ready().then((t=>this.#C())),this.#y.on("play",(t=>this.#Y())),this.#y.on("pause",(t=>this.#S())),this.#y.on("ended",(t=>this.#B())),xt&&this.#y.on("fullscreenchange",(t=>{this.panel.setPlayIcon(!t.fullscreen)}))}async#z(t){const e=t=>{if(this[b])return this[b],t(t);if(this[b]=prompt("Youtube 影片ID / 網址"),/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(this[b])){let e=videoId.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);this[b]=e&&11==e[7][f]?e[7]:null,this[b]?(history.pushState(null,null,location.href.split("?")[0]+`?videoId=${this[b]}`),t()):fitVideoId(t)}else t(t)};if(!t)return new Promise(((t,i)=>e(t)));e(t)}destroy(){this[p][yt]=this[p][ct]=null,clearInterval(this.videoTimer),this.#s?this.#y.destroy():this.#i?(this.#y.destroy(),this.#c&&this.#c.destroy()):(this.#t||this.#e)&&(this.#y.pause(),this.#y.src=""),null!=this.panel.buttonPlay&&(this.panel.buttonPlay.onclick=null),null!=this.panel.buttonVolume&&(this.panel.buttonVolume.onclick=null),null!=this.panel.buttonMute&&(this.panel.buttonMute.onclick=null),null!=this.panel.buttonRate&&(this.panel.buttonRate.onclick=null),null!=this.panel.buttonFull&&(this.panel.buttonRate.onclick=null),null!=this.panel.inputVolume&&(this.panel.inputVolume.oninput=null),null!=this.panel.inputVolumeMini&&(this.panel.inputVolumeMini.oninput=null),null!=this.panel.inputProgress&&(this.panel.inputProgress.oninput=null),this.panel[p].onmouseover=null,this[p].remove(),"function"==typeof this.when.destroyed&&this.when.destroyed()}};class Yt{body;#O;#T;#I;buttonPlay;buttonVolume;buttonMute;buttonRate;buttonFull;inputProgress;inputVolume;inputVolumeMini;#j;#q;#N=8;constructor(t){this.#T=t,this.body=It("div.panel"),this.body.onmouseover=t=>this.show();for(let e of t.option.panelItem)this.#Z(e),this.#J(t,e),this.#G(t,e),this.#H(t,e),this.#K(e,t.option.volume),this.#Q(e,t.option.volume),this.#U(t,e,1),this.#W(t,e);"minimal"===t.option.panelType&&(this.body.style.width=this.#N+"px")}#Z(t){"play"===t&&(this.#N+=24,this.buttonPlay=It("span.material-symbols-outlined","play_arrow"),this.body[q](this.buttonPlay))}#J(t,e){"progress"===e&&(this.inputProgress=It("input.progress",{type:"range",name:"progress",min:0,value:0}),this.body[q](It("section.progress",[It("progress",{min:0,max:100}),this.inputProgress])))}#G(t,e){"timeMini"===e&&"minimal"!==t.option.panelType&&(this.#j=It("p.time","--:--"),this.body[q](this.#j))}#H(t,e){"time"===e&&"minimal"!==t.option.panelType&&(this.#q=It("p.time","--:--/--:--"),this.body[q](this.#q))}#K(t,e){"volume"===t&&(this.#N+=104,this.buttonMute=It("span.material-symbols-outlined",this.#X),this.inputVolume=It("input.volume",{type:"range",name:"volume",min:0,max:100,value:e}),this.body[q](It("section.volume",[this.buttonMute,It("section",[It("progress",{min:0,max:100,value:e}),this.inputVolume])])))}#Q(t,e){"volumeMini"===t&&(this.#N+=32,this.buttonVolume=It("span.material-symbols-outlined",this.#X),this.inputVolumeMini=It("input",{type:"range",name:"volume",min:0,max:100,value:e}),this.body[q](It("details.volume",[It("summary",[this.buttonVolume]),It("section",[It("progress",{min:0,max:100,value:e}),this.inputVolumeMini])])))}#U(t,e,i){"rate"===e&&(this.#N+=32,this.buttonRate=It("span.material-symbols-outlined","1x_mobiledata"),this.body[q](this.buttonRate))}#W(t,e){"full"===e&&null==this.#T.audio&&(this.#N+=32,this.buttonFull=It("span.material-symbols-outlined","fullscreen"),this.buttonFull.onclick=e=>{const i=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||!1,s=t.body.requestFullscreen||t.body.msRequestFullscreen||t.body.mozRequestFullScreen||t.body.webkitRequestFullscreen,l=document.exitFullscreen||document.msExitFullscree||document.mozCancelFullScreen||document.webkitExitFullscreen;t.stateFull=!i,i?xt?t.mobilePause():l&&l.call(document):xt?(t.pause(),t.play(!0)):s&&s.call(t.body)},this.body[q](this.buttonFull))}get#X(){return this.#T.isMuted()?"no_sound":"volume_up"}setPlayIcon(t){null!=this.buttonPlay&&(this.buttonPlay.innerText=t?"play_arrow":"pause")}setMuteIcon(t){null!=this.buttonMute&&(this.buttonMute[$]=t?"no_sound":"volume_up"),null!=this.inputVolume&&(this.inputVolume.value=t?0:this.#T.option.volume,this.inputVolume.previousElementSibling.value=t?0:this.#T.option.volume)}reset(){null!=this.buttonPlay&&(this.buttonPlay.innerText="play_arrow"),this.show(),this.setCurrent(0)}setVolume(t){null!=this.inputVolume&&(this.inputVolume.value=t,this.inputVolume.previousElementSibling.value=t),null!=this.inputVolumeMini&&(this.inputVolumeMini.value=t,this.inputVolumeMini.previousElementSibling.value=t)}duration(t){const e=Math.ceil(t);this.#I=e,null!=this.inputProgress&&(this.inputProgress.max=e,this.inputProgress.previousElementSibling.max=e),null!=this.#q&&(this.#q.innerText=_t(0,e)+"/"+_t(this.#I,this.#I))}setCurrent(t){null!=this.inputProgress&&(this.inputProgress.value=t,this.inputProgress.previousElementSibling.value=t),null==t||null==this.#j&&null==this.#q||(null!=this.#j&&(this.#j.innerText=_t(t,this.#I)),null!=this.#q&&(this.#q.innerText=_t(t,this.#I)+"/"+_t(this.#I,this.#I)))}show(){clearTimeout(this.#O),this.body.classList.remove("hide")}hide(t){clearTimeout(this.#O),this.#O=setTimeout((t=>{this.#T.isPaused()||this.body.classList.add("hide")}),1e3*t)}}}("undefined"==typeof window?window={}:window);export const player = window.PDPlayer;
